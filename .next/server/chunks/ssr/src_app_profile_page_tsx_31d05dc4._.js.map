{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Desktop/projects/nutri-mind/src/app/profile/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { selectUserForm, setUserForm } from \"@/stores/userFormApi\";\r\nimport { RootState } from \"@/stores\";\r\n\r\nexport default function ProfilePage() {\r\n  const [user, setUser] = useState<any>(null);\r\n  const [photoUrl, setPhotoUrl] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    supabase.auth.getUser().then(({ data }) => setUser(data.user));\r\n  }, []);\r\n  const userId = user?.email || \"\";\r\n  const userForm = useSelector((state: RootState) => selectUserForm(state.userForm, userId));\r\n\r\n  const [form, setForm] = useState({\r\n    name: userForm?.name || \"\",\r\n    age: userForm?.age || \"\",\r\n    length: userForm?.length || \"\",\r\n    weight: userForm?.weight || \"\",\r\n    password: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    setForm({\r\n      name: userForm?.name || \"\",\r\n      age: userForm?.age || \"\",\r\n      length: userForm?.length || \"\",\r\n      weight: userForm?.weight || \"\",\r\n      password: \"\",\r\n    });\r\n  }, [userForm]);\r\n\r\n  useEffect(() => {\r\n    if (user?.user_metadata?.avatar_url) {\r\n      setPhotoUrl(user.user_metadata.avatar_url);\r\n    } else if (user?.id) {\r\n      // Try to get from Supabase Storage\r\n      supabase.storage.from(\"avatars\").download(`${user.id}/avatar.jpg`).then(({ data, error }) => {\r\n        if (!error && data) {\r\n          const url = URL.createObjectURL(data);\r\n          setPhotoUrl(url);\r\n        }\r\n      });\r\n    }\r\n  }, [user]);\r\n\r\n  const handleChange = (e: any) => {\r\n    const { name, value } = e.target;\r\n    setForm((prev) => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const handlePhotoUpload = async (e: any) => {\r\n    const file = e.target.files[0];\r\n    if (!file || !user) return;\r\n    setUploading(true);\r\n    const filePath = `${user.id}/avatar.jpg`;\r\n    const { error } = await supabase.storage.from(\"avatars\").upload(filePath, file, { upsert: true });\r\n    if (!error) {\r\n      const { data } = supabase.storage.from(\"avatars\").getPublicUrl(filePath);\r\n      setPhotoUrl(data.publicUrl);\r\n      setSuccess(\"Photo updated!\");\r\n    } else {\r\n      setError(\"Failed to upload photo.\");\r\n    }\r\n    setUploading(false);\r\n  };\r\n\r\n  const handleSubmit = async (e: any) => {\r\n    e.preventDefault();\r\n    setSuccess(null);\r\n    setError(null);\r\n    // Update password if provided\r\n    if (form.password) {\r\n      const { error } = await supabase.auth.updateUser({ password: form.password });\r\n      if (error) {\r\n        setError(error.message);\r\n        return;\r\n      }\r\n    }\r\n    // Update name in Supabase user metadata\r\n    if (form.name && form.name !== user?.user_metadata?.name) {\r\n      await supabase.auth.updateUser({ data: { name: form.name } });\r\n    }\r\n    // Update Redux form data\r\n    dispatch(setUserForm({\r\n      userId,\r\n      data: {\r\n        ...userForm,\r\n        name: form.name,\r\n        age: Number(form.age),\r\n        length: Number(form.length),\r\n        weight: Number(form.weight),\r\n      },\r\n    }));\r\n    setSuccess(\"Profile updated!\");\r\n  };\r\n\r\n  if (!user) {\r\n    return <div className=\"text-center mt-10 text-lg\">Please log in to view your profile.</div>;\r\n  }\r\n\r\n  return (\r\n    <section className=\"flex flex-col items-center justify-center min-h-[60vh] bg-zinc-50 dark:bg-zinc-900/60\">\r\n      <form\r\n        onSubmit={handleSubmit}\r\n        className=\"w-full max-w-lg bg-white dark:bg-zinc-900/80 rounded-2xl shadow-xl border border-zinc-200 dark:border-zinc-800 p-8 flex flex-col gap-6\"\r\n      >\r\n        <div className=\"flex flex-col items-center gap-2\">\r\n          <div className=\"relative\">\r\n            <img\r\n              src={photoUrl || \"/assets/avatars/default.png\"}\r\n              alt=\"Profile\"\r\n              className=\"w-24 h-24 rounded-full object-cover border-4 border-primary shadow\"\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => fileInputRef.current?.click()}\r\n              className=\"absolute bottom-0 right-0 bg-primary text-white rounded-full p-2 shadow hover:bg-primary/90 focus:outline-none\"\r\n              disabled={uploading}\r\n            >\r\n              <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\"><path d=\"M12 16v-4m0 0V8m0 4h4m-4 0H8m12 4v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-4\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/></svg>\r\n            </button>\r\n            <input\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              ref={fileInputRef}\r\n              className=\"hidden\"\r\n              onChange={handlePhotoUpload}\r\n              disabled={uploading}\r\n            />\r\n          </div>\r\n          <div className=\"text-zinc-600 dark:text-zinc-300 text-sm mt-1\">Click photo to change</div>\r\n        </div>\r\n        <div className=\"flex flex-col gap-2\">\r\n          <label className=\"font-medium text-zinc-700 dark:text-zinc-200\">Email</label>\r\n          <input\r\n            type=\"email\"\r\n            value={user.email}\r\n            readOnly\r\n            className=\"w-full px-4 py-2 rounded-lg border border-border bg-zinc-100 dark:bg-zinc-800 text-base text-zinc-500 cursor-not-allowed\"\r\n          />\r\n        </div>\r\n        <div className=\"flex flex-col gap-2\">\r\n          <label className=\"font-medium text-zinc-700 dark:text-zinc-200\">Password</label>\r\n          <input\r\n            type=\"password\"\r\n            name=\"password\"\r\n            value={form.password}\r\n            onChange={handleChange}\r\n            placeholder=\"Change password\"\r\n            className=\"w-full px-4 py-2 rounded-lg border border-border bg-white/80 dark:bg-zinc-900/70 text-base text-foreground placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition hover:border-primary/70 shadow-sm\"\r\n          />\r\n        </div>\r\n        <div className=\"flex flex-col gap-2\">\r\n          <label className=\"font-medium text-zinc-700 dark:text-zinc-200\">Name</label>\r\n          <input\r\n            type=\"text\"\r\n            name=\"name\"\r\n            value={form.name}\r\n            onChange={handleChange}\r\n            className=\"w-full px-4 py-2 rounded-lg border border-border bg-white/80 dark:bg-zinc-900/70 text-base text-foreground placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition hover:border-primary/70 shadow-sm\"\r\n          />\r\n        </div>\r\n        <div className=\"flex flex-col gap-2\">\r\n          <label className=\"font-medium text-zinc-700 dark:text-zinc-200\">Age</label>\r\n          <input\r\n            type=\"number\"\r\n            name=\"age\"\r\n            value={form.age}\r\n            onChange={handleChange}\r\n            className=\"w-full px-4 py-2 rounded-lg border border-border bg-white/80 dark:bg-zinc-900/70 text-base text-foreground placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition hover:border-primary/70 shadow-sm\"\r\n          />\r\n        </div>\r\n        <div className=\"flex flex-col gap-2\">\r\n          <label className=\"font-medium text-zinc-700 dark:text-zinc-200\">Length (cm)</label>\r\n          <input\r\n            type=\"number\"\r\n            name=\"length\"\r\n            value={form.length}\r\n            onChange={handleChange}\r\n            className=\"w-full px-4 py-2 rounded-lg border border-border bg-white/80 dark:bg-zinc-900/70 text-base text-foreground placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition hover:border-primary/70 shadow-sm\"\r\n          />\r\n        </div>\r\n        <div className=\"flex flex-col gap-2\">\r\n          <label className=\"font-medium text-zinc-700 dark:text-zinc-200\">Weight (kg)</label>\r\n          <input\r\n            type=\"number\"\r\n            name=\"weight\"\r\n            value={form.weight}\r\n            onChange={handleChange}\r\n            className=\"w-full px-4 py-2 rounded-lg border border-border bg-white/80 dark:bg-zinc-900/70 text-base text-foreground placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition hover:border-primary/70 shadow-sm\"\r\n          />\r\n        </div>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"btn btn-primary w-full py-2 rounded-lg font-semibold text-lg bg-primary text-white shadow-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition\"\r\n        >\r\n          Update Profile\r\n        </button>\r\n        {success && <div className=\"text-green-600 text-center mt-2\">{success}</div>}\r\n        {error && <div className=\"text-red-500 text-center mt-2\">{error}</div>}\r\n      </form>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AAJA;;;;;;AAOe,SAAS;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAO;IACtC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IACxD,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IACtD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,eAAe,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAoB;IAC9C,MAAM,WAAW,CAAA,GAAA,yJAAA,CAAA,cAAW,AAAD;IAE3B,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,sHAAA,CAAA,WAAQ,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,GAAK,QAAQ,KAAK,IAAI;IAC9D,GAAG,EAAE;IACL,MAAM,SAAS,MAAM,SAAS;IAC9B,MAAM,WAAW,CAAA,GAAA,yJAAA,CAAA,cAAW,AAAD,EAAE,CAAC,QAAqB,CAAA,GAAA,4HAAA,CAAA,iBAAc,AAAD,EAAE,MAAM,QAAQ,EAAE;IAElF,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;QAC/B,MAAM,UAAU,QAAQ;QACxB,KAAK,UAAU,OAAO;QACtB,QAAQ,UAAU,UAAU;QAC5B,QAAQ,UAAU,UAAU;QAC5B,UAAU;IACZ;IAEA,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,QAAQ;YACN,MAAM,UAAU,QAAQ;YACxB,KAAK,UAAU,OAAO;YACtB,QAAQ,UAAU,UAAU;YAC5B,QAAQ,UAAU,UAAU;YAC5B,UAAU;QACZ;IACF,GAAG;QAAC;KAAS;IAEb,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,MAAM,eAAe,YAAY;YACnC,YAAY,KAAK,aAAa,CAAC,UAAU;QAC3C,OAAO,IAAI,MAAM,IAAI;YACnB,mCAAmC;YACnC,sHAAA,CAAA,WAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,QAAQ,CAAC,GAAG,KAAK,EAAE,CAAC,WAAW,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE;gBACtF,IAAI,CAAC,SAAS,MAAM;oBAClB,MAAM,MAAM,IAAI,eAAe,CAAC;oBAChC,YAAY;gBACd;YACF;QACF;IACF,GAAG;QAAC;KAAK;IAET,MAAM,eAAe,CAAC;QACpB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM;QAChC,QAAQ,CAAC,OAAS,CAAC;gBAAE,GAAG,IAAI;gBAAE,CAAC,KAAK,EAAE;YAAM,CAAC;IAC/C;IAEA,MAAM,oBAAoB,OAAO;QAC/B,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE;QAC9B,IAAI,CAAC,QAAQ,CAAC,MAAM;QACpB,aAAa;QACb,MAAM,WAAW,GAAG,KAAK,EAAE,CAAC,WAAW,CAAC;QACxC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,sHAAA,CAAA,WAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,MAAM,CAAC,UAAU,MAAM;YAAE,QAAQ;QAAK;QAC/F,IAAI,CAAC,OAAO;YACV,MAAM,EAAE,IAAI,EAAE,GAAG,sHAAA,CAAA,WAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,YAAY,CAAC;YAC/D,YAAY,KAAK,SAAS;YAC1B,WAAW;QACb,OAAO;YACL,SAAS;QACX;QACA,aAAa;IACf;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,WAAW;QACX,SAAS;QACT,8BAA8B;QAC9B,IAAI,KAAK,QAAQ,EAAE;YACjB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,sHAAA,CAAA,WAAQ,CAAC,IAAI,CAAC,UAAU,CAAC;gBAAE,UAAU,KAAK,QAAQ;YAAC;YAC3E,IAAI,OAAO;gBACT,SAAS,MAAM,OAAO;gBACtB;YACF;QACF;QACA,wCAAwC;QACxC,IAAI,KAAK,IAAI,IAAI,KAAK,IAAI,KAAK,MAAM,eAAe,MAAM;YACxD,MAAM,sHAAA,CAAA,WAAQ,CAAC,IAAI,CAAC,UAAU,CAAC;gBAAE,MAAM;oBAAE,MAAM,KAAK,IAAI;gBAAC;YAAE;QAC7D;QACA,yBAAyB;QACzB,SAAS,CAAA,GAAA,4HAAA,CAAA,cAAW,AAAD,EAAE;YACnB;YACA,MAAM;gBACJ,GAAG,QAAQ;gBACX,MAAM,KAAK,IAAI;gBACf,KAAK,OAAO,KAAK,GAAG;gBACpB,QAAQ,OAAO,KAAK,MAAM;gBAC1B,QAAQ,OAAO,KAAK,MAAM;YAC5B;QACF;QACA,WAAW;IACb;IAEA,IAAI,CAAC,MAAM;QACT,qBAAO,8OAAC;YAAI,WAAU;sBAA4B;;;;;;IACpD;IAEA,qBACE,8OAAC;QAAQ,WAAU;kBACjB,cAAA,8OAAC;YACC,UAAU;YACV,WAAU;;8BAEV,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,KAAK,YAAY;oCACjB,KAAI;oCACJ,WAAU;;;;;;8CAEZ,8OAAC;oCACC,MAAK;oCACL,SAAS,IAAM,aAAa,OAAO,EAAE;oCACrC,WAAU;oCACV,UAAU;8CAEV,cAAA,8OAAC;wCAAI,OAAM;wCAAK,QAAO;wCAAK,MAAK;wCAAO,SAAQ;kDAAY,cAAA,8OAAC;4CAAK,GAAE;4CAAuE,QAAO;4CAAe,aAAY;4CAAI,eAAc;4CAAQ,gBAAe;;;;;;;;;;;;;;;;8CAExN,8OAAC;oCACC,MAAK;oCACL,QAAO;oCACP,KAAK;oCACL,WAAU;oCACV,UAAU;oCACV,UAAU;;;;;;;;;;;;sCAGd,8OAAC;4BAAI,WAAU;sCAAgD;;;;;;;;;;;;8BAEjE,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAM,WAAU;sCAA+C;;;;;;sCAChE,8OAAC;4BACC,MAAK;4BACL,OAAO,KAAK,KAAK;4BACjB,QAAQ;4BACR,WAAU;;;;;;;;;;;;8BAGd,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAM,WAAU;sCAA+C;;;;;;sCAChE,8OAAC;4BACC,MAAK;4BACL,MAAK;4BACL,OAAO,KAAK,QAAQ;4BACpB,UAAU;4BACV,aAAY;4BACZ,WAAU;;;;;;;;;;;;8BAGd,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAM,WAAU;sCAA+C;;;;;;sCAChE,8OAAC;4BACC,MAAK;4BACL,MAAK;4BACL,OAAO,KAAK,IAAI;4BAChB,UAAU;4BACV,WAAU;;;;;;;;;;;;8BAGd,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAM,WAAU;sCAA+C;;;;;;sCAChE,8OAAC;4BACC,MAAK;4BACL,MAAK;4BACL,OAAO,KAAK,GAAG;4BACf,UAAU;4BACV,WAAU;;;;;;;;;;;;8BAGd,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAM,WAAU;sCAA+C;;;;;;sCAChE,8OAAC;4BACC,MAAK;4BACL,MAAK;4BACL,OAAO,KAAK,MAAM;4BAClB,UAAU;4BACV,WAAU;;;;;;;;;;;;8BAGd,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAM,WAAU;sCAA+C;;;;;;sCAChE,8OAAC;4BACC,MAAK;4BACL,MAAK;4BACL,OAAO,KAAK,MAAM;4BAClB,UAAU;4BACV,WAAU;;;;;;;;;;;;8BAGd,8OAAC;oBACC,MAAK;oBACL,WAAU;8BACX;;;;;;gBAGA,yBAAW,8OAAC;oBAAI,WAAU;8BAAmC;;;;;;gBAC7D,uBAAS,8OAAC;oBAAI,WAAU;8BAAiC;;;;;;;;;;;;;;;;;AAIlE","debugId":null}}]
}